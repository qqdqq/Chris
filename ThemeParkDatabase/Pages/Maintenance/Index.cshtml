@page
@model ThemeParkDatabase.Pages.Maintenance.IndexModel

@{
    ViewData["Title"] = "Index";
}

<h2>Maintenance</h2>

<div id="dual_x_div" style="width: 900px; height: 500px;"></div>


@*@{ 
    int numOfRidesBroken = 0;
    foreach (var request in Model.MaintenanceRequest)
    {
        if (request.DateResolved == null)
        {
            numOfRidesBroken++;
        }
    }
    <p>@numOfRidesBroken</p>

    foreach (var request in Model.MaintenanceRequest)
    {
        if (request.DateResolved == null)
        {
            <table class="table table-responsive table-hover table-striped">
                <thead>
                    <tr>
                        <th><b>@Html.DisplayFor(r => request.Attraction.Name)</b></th>
                    </tr>
                </thead>
                <tbody>
                    @{ 
                        var dateRequested = String.Format("{0:MM/dd/yyyy}", request.DateRequested);
                    }
                    <tr>
                        <td><b>Description</b></td>
                        <td>@Html.DisplayFor(r => request.Description)</td>
                    </tr>
                    <tr>
                        <td><b>Date Requested</b></td>
                        <td>@dateRequested</td>
                    </tr>
                    <tr>
                        <td><b>Current Status</b></td>
                        <td>@Html.DisplayFor(r => request.CurrentStatus)</td>
                    </tr>
                    <tr>
                        <td><b>Estimated Cost</b></td>
                        <td>$@Html.DisplayFor(r => request.EstimatedCost)</td>
                    </tr>
                </tbody>
            </table>
        }
    }
}*@

@*<div id="repair-graph" style="width: 900px; height: 300px;"></div>*@

@*<table class="table table-hover table-responsive table-striped" id="maintenance-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Attraction</th>
            <th>Current Status</th>
            <th>Date Requested</th>
            <th>Estimated Cost</th>
            <th>Date Resolved</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var request in Model.MaintenanceRequest)
        {
            var dateRequested = String.Format("{0:MM/dd/yyyy}", request.DateRequested);
            var dateResolved = String.Format("{0:MM/dd/yyyy}", request.DateResolved);
        <tr>
            <td>@Html.DisplayFor(r => request.Id)</td>
            <td>@Html.DisplayFor(r => request.Attraction.Name)</td>
            <td>@Html.DisplayFor(r => request.CurrentStatus)</td>
            <td>@dateRequested</td>
            <td>$@Html.DisplayFor(r => request.EstimatedCost)</td>
            <td>@dateResolved</td>
        </tr>

        }
    </tbody>
</table>*@


@section scripts
{
    <script>
        $(document).ready(function () {
            google.charts.load("current", { packages: ["bar", "controls"] });
            google.charts.setOnLoadCallback(drawDashboard);

            function drawDashboard() {
                $.ajax({
                    url: "/Maintenance?handler=CostNumberGraph",
                    type: "GET",
                    dataType: "json",
                    success: function (json) {
                        console.log(json);
                        var data = new google.visualization.arrayToDataTable(json);

                        var options = {
                            width: 800,
                            chart: {
                                title: "Total Costs vs Number of Requests"
                            },
                            bars: "horizontal",
                            series: {
                                0: { axis: "Total Cost" },
                                1: { axis: "Number of Requests" }
                            },
                            axes: {
                                x: {
                                    "Total Cost": { label: "Total Cost" },
                                    "Number of Requests": { side: "top", label: "Number of Requests" } 
                                }

                            }
                        }

                        var chart = new google.charts.Bar(document.getElementById("dual_x_div"));
                        chart.draw(data, options);
                    }
                });
            }





            //function drawChart() {
            //    $.ajax({
            //        url: "/Maintenance?handler=MaintenanceCostGraph",
            //        type: "GET",
            //        dataType: "json",
            //        success: function (json) {
            //            var data = google.visualization.arrayToDataTable(json);

            //            var options = {
            //                title: "Total Repair Costs",
            //                width: 600,
            //                height: 400,
            //                bar: { groupwidth: "95%" },
            //                legend: { poisition: "none" },
            //                animation: {
            //                    startup: true,
            //                    duration: 1000,
            //                    easing: 'out'
            //                }
            //            };
            //            var chart = new google.visualization.ColumnChart(document.getElementById("repair-graph"));
            //            chart.draw(data, options);
            //        }
            //    });
            //}

            //$("#maintenance-table").DataTable();
        });
    </script>
}


<p>
        <a asp-page="Create">Create New</a>
    </p>
    <table class="table">
        <thead>
            <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.MaintenanceRequest[0].Description)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.MaintenanceRequest[0].DateRequested)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.MaintenanceRequest[0].DateResolved)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.MaintenanceRequest[0].CurrentStatus)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.MaintenanceRequest[0].EstimatedCost)
                    </th>
                <th>
                    @Html.DisplayNameFor(model => model.MaintenanceRequest[0].Attraction)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
    @foreach (var item in Model.MaintenanceRequest) {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateRequested)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateResolved)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CurrentStatus)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.EstimatedCost)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Attraction.Name)
                </td>
                <td>
                    <a asp-page="./Edit" asp-route-id="@item.Id">Edit</a> |
                    <a asp-page="./Details" asp-route-id="@item.Id">Details</a> |
                    <a asp-page="./Delete" asp-route-id="@item.Id">Delete</a>
                </td>
            </tr>
    }
        </tbody>
    </table>
